
---
// Projects component
const projects = [
   { 
    id: 0, 
    title: 'Tribeca Immersive 2025', 
    roleTitle: 'Technical Floor Manager',
    links: [{link: 'https://tribecafilm.com/festival/immersive', text: 'Festival Guide'}, {link: 'https://www.onx.studio/onx-programming/tribeca-immersive-2025', text: 'ONX Guide'}, {link: 'https://agog.org/tribeca-immersive-2025/', text: 'Agog Guide'}, {link: 'https://www.cbsnews.com/news/2025-tribeca-festival-virtual-reality-augmented-reality-exhibitions/', text: 'CBS News Press'}],
    techUsed: 'VR, XR, AR, Touchdesigner, Arduino, Haptic Immersive Suits, Omnidirectional Audio, Multi-Projection Mapping',
    description: 'An immersive exhibition of VR, XR, and AR experiences presented at the Tribeca Film Festival. 11 Installations lined the halls of a massive space in the heart of New York\'s Financial District.', 
    details: `Described as a “genre-defying exhibition,” this collection of eleven immersive experiences marked the culmination of a year-long collaboration with ONX Onassis. I served as Technical Floor Manager, overseeing the setup, maintenance, and takedown of this large-scale production. My responsibilities included ensuring the technical integrity of all installations, which spanned a wide range of mediums and technologies. These involved extensive use of TouchDesigner, Arduino, VR/XR/AR systems, haptic immersive suits, omnidirectional audio, and complex multi-projection mapping—including a projector suspended 30 feet in the air, casting imagery onto a life-sized loom.
<br><br>
This exhibition attracted hundreds, if not thousands, of attendees and garnered press coverage from outlets including CBS News, New York Theater, Surface Magazine, and Variety. Beyond its scale and visibility, the project demanded both detailed artist management and rapid, real-time troubleshooting. Challenges ranged from recovering after an unexpected power surge that disabled multiple computers, to navigating faulty Arduino hardware, maintaining delicate haptic suits, and ensuring the daily technical stability of each installation. This experience represented a true culmination of the emerging technologies I have been deeply engaged with—spanning interactive systems, immersive media, and responsive environments.`,
    imageUrl: '/img/tribecaImmersive.webp',
    gallery: [
      {original: "/img/ti1.webp", type: "image"}, 
      {original: "/img/ti2.webp", type: "image"}, 
      {original: "/img/ti3.webp", type: "image"}, 
      {original: "/img/ti4.webp", type: "image"},
     ],
  },
  { 
    id: 1, 
    title: 'Morning Light', 
    roleTitle: 'Creative Technologist/Score Composer',
    links: [{link: 'https://www.instagram.com/chachafestival/?hl=en', text: 'Cha Cha Fest Instagram'}, {link: 'https://interiordesign.net/designwire/highlights-from-new-yorks-cha-cha-festival/#:~:text=Oolong%20Tea%20House%3A%20Morning%20Light%20by%20Aaron%20Santiago%20%26%20Michaela%20Ternasky%2DHolland&text=Michaela%20Ternasky%2DHolland-,Oolong%20Tea%20House.,-Visual%20artists%20Aaron', text: 'Press from Interior Design Magazine'}],
    techUsed: 'Javascript, Tone.js, Socket.io, OpenAI GPT, Touchdesigner, Ableton',
    description: 'An immersive installation surrounding the ancient art of tea leaf reading. Participants place down their tea cup where and are offers divine wisdom in return.', 
    details: "This installation was presented at the Cha Cha Festival in New York City that celebrates tea and its rituals. Within the WSA building, the installation was designed to create a meditative space where participants could seek guidance through the ritual of tea leaf reading. My role involved composing the score for the installation, and working closely with head Artist Aaron Santiago. I utilized Tone.js for the audio synthesis and Socket.io to handle real-time communication between the installation's components. We used OpenAI's GPT model to provide dynamic and personalized responses based on the tea leaves' patterns. which allowed for a seamless blend of audio and visual elements, enhancing the overall experience.",
    imageUrl: '/img/morningLight.jpg',
    gallery: [
      {original: "/img/ml2.jpg", type: "image"}, 
      {original: "/img/ml1.jpg", type: "image"}, 
      {original: "/img/ml3.jpg", type: "image"}, 
      {original: "/img/ml4.jpg", type: "image"},
     ],
  },
  { 
    id: 2, 
    title: 'Under The Radar: A Room of One\'s Own', 
    roleTitle: 'Score Composer/Technical Director',
    links: [{link: "https://utrfest.org/program/a-room-of-ones-own/", text: "Under The Radar Festival"}],
    techUsed: 'Ableton, Touchdesigner, Live Mixing',
    description: "A room of one's own is an XR performance and wholly unique experience about making creative work within a confined space.", 
    details: `Through voice loops, motion capture, and audio-visual fragments in projected scenes, 
    the unnamed protagonist takes us through their adolescence as they navigate sickness, immigration, and a multilingual artistic career. 
    Reality and fiction bleed together in this playful and raw exploration of the joys and horrors of being trapped in one’s own creative brain. <br><br>
    This piece was presented at the Under The Radar Festival in New York City staring and created by my longtime friend and collaborator, Viola He. We worked together to build a soundscape and composition that reflected the playful gravity of the piece. 
    I worked as the Technical Director for the piece and the show Runway which also was shown at the festival, and was responsible for the live mixing of the piece.`,
    imageUrl: '/img/roomOfOnesOwn.jpg',
    gallery: [
      {original: "/img/room3.jpg", type: "image"}, 
      {original: "/img/room2.jpg", type: "image"}, 
      {original: "/img/room1.jpg", type: "image"}],
  },
  { 
    id: 3, 
    title: 'Fras Fest', 
    roleTitle: 'Head Organizer/Creator',
    techUsed: 'Ableton, Lighting Design, Live Mixing',
    description: "A music festival showcasing amazing artists from across the northeastern music scene working alongside technical artists to create a one of a kind experience.", 
    details: `
    With over 30 artists involved this was the most ambitious live show I've ever been a part of. After organizing many shows around NYC and Brooklyn for about 3 years, I decided to take the leap and create my own festival. 
    Working with family friends who own a wedding venue in upstate NY, we were able to create a space that was truly unique and one of a kind. We built out an indoor and outdoor performance space that allowed for live projections, music, and a truly immersive experience. 
    <br><br>
    The festival was a huge success and not only were we able to showcase the amazing artists that attened, but we are confirmed to be back for 2026! Excited to make Fras Fest a yearly event and continue to present the best of the northeast's music scene.
    `,
    imageUrl: '/img/frasFest.jpg',
    links: [{link: "https://www.instagram.com/frasfest/", text: "Fras Fest Instagram"}, {link: "https://www.sassafrasruins.com/", text: "Our Venue"}],
    gallery: [
      {original: "/img/ff1.jpg", type: "image"}, 
      {original: "/img/ff2.jpg", type: "image"}, 
      {original: "/img/ff3.mov", type: "video"},
     ],
  },
  { 
    id: 4, 
    title: 'Please Wake Up Daddy', 
    roleTitle: 'Co-Creator',
    links: [{link: "https://pleasewakeupdaddy.com/", text: "Web Experience"}],
    techUsed: 'Javascript, Three.js, Web Audio API, Blender',
    description: 'An interactive installation that requires the audience to scream to wake up their sleeping father for a unique surprise.', 
    details: `
     We are currently building out this experience into a larger video game/immersive theater experience. The deeper experience will be presented at ONX Onassis this fall and will require the audience to inhabit a dejected recent college graduate fighting to figure out how to navigate their own isolation. There is also a website version of this experience that you can interact with now.
    `,
    imageUrl: '/img/wakeUpDaddy.jpg',
    gallery: [
      {original: "/img/pleasewakeupdaddy.png"}
     ],
  },
  { 
    id: 5, 
    title: 'Theater Royale', 
    roleTitle: 'Creative Technologist',
    techUsed: 'Javascript, Socket.io, OBS',
    links: [{link: "https://www.twitch.tv/theatreroyale", text: "Theater Royale Twitch" }, {link: "https://www.americantheatre.org/2025/03/07/game-plays-the-thing-for-new-fortnite-based-theatre-company/", text: "Press: American Theater"}],
    description: "It's both a theater company and an interactive livestream. Working with under Lincoln Center's resident Brandon Powers, we created a system to allow actors to play Fortnite while performing a play and stream on Twitch.", 
    details: `
    Two actors perform a play—currently in rotation are Waiting for Godot by Samuel Beckett, Antigone by Sophocles, and Love Letters by A. R. Gurney—while simultaneously playing the video game Fortnite. My role in this project
    was to create an overlay for the actors to be able to read the script while playing the game, and allow for a third party to be able to send messages to the actors during the show. We created a web app that acted as an overlay which scrolled through the script and displayed it on a screen in front of the actors
    while 
    `,
    imageUrl: '/img/theaterRoyal.jpg'
  },
  { 
    id: 6, 
    title: 'Dear Dancer', 
    roleTitle: 'Creative Technologist/Web Developer',
    techUsed: 'Javascript, Three.js, Blender, Chrome Extension Development',
    links: [{link: "https://www.deardancer.io/", text: "Dear Dancer Website"}, {link: "https://chromewebstore.google.com/detail/dear-dancer/hoajbihdcdmnmjlgkmlkecpcnkmokipb", text: "Chrome Extension"}],
    description: 'A web experience that allows the user to interact with a 3D dancer via typing. This functions both as a Chrome extension you can use across the web and an addition to the Dear Dancer website.', 
    details: `
    Each letter is uniquely mapped to a dance move which have all been performed, 3D modeled and mapped onto an avatar, and as the user types the words will be perfomred back at the user.
    <br><br>
    This project was a real challenge and taught me a lot about 3D modeling and animation. I also learned a lot about the complexities of working with 3D models in a web environment, specifically how to optimize them for the web and allow for a fully client side experience to avoid what could be maliciously used as a key tracker.
    `,
    imageUrl: '/img/dearDancer.png'
  },

  { 
    id: 8, 
    title: 'Tempo Turtle', 
    roleTitle: 'Co-Founder',
    links: [{link: "https://tempoturtle.com/", text: "Our Website"}, {link: "https://www.instagram.com/p/CSjx59LFC_U/", text: "Our Product"}],
    gallery: [
      {original: "/img/tt1.jpg", type: "image"}, 
      {original: "/img/tt2.jpg", type: "image"}, 
     ],
    techUsed: 'React, Three.js, Juce, C++',
    details: `
    Tempo Turtle is a company I started with my friend for our exploration of music technology both on the hardware and software side. We have created a couple of products and are currently working on creating a couple open-source software effects.
    <br><br>
    The first product we created is called the Brad Pad. It is a hardware device designed for music production with a form factor that allows you to hold the device in your hands.
    <br><br>
    We are currently working on a software effect that allows you to use a large turtle dial to control the speed of your playback. We are focused on creating intuative and easy to use music production tools that are accessible to everyone.
    `,
    description: 'A company I started with my friend for our exploration of music technology both on the hardware and software side. We have created a couple of products and are currently working on creating a couple open-source software effects.', 
    imageUrl: '/img/tempoTurtle.jpg'
  },
];

const discarded =  [{ 
    id: 7, 
    title: 'To Start in the Dark', 
    techUsed: 'Ableton, Acelorometers, Max For Live',
    description: 'A live performance/Interactive installation that explored movement based control of music. The goal was to create an understandable system that could be explored much like coming into contact with a new instrument or an unfamiliar way to express yourself that can be easily explored.', 
    imageUrl: '/img/toStartInTheDark.jpg'
  }]
---

<div id="projects" class="projects-container">
    <h2>Projects</h2>
    <div class="projects-grid">
        {projects.map((project) => (
            <div 
                data-project-trigger={project.id}
                id={`project-${project.id}`}
                class="project-card"
                data-project-id={project.id}
            >
                <img 
                    style="border-radius: 8px;"
                    src={project.imageUrl} 
                    alt={project.title} 
                    class="project-image"
                    data-project-trigger={project.id}
                />
                
                <div class="project-text">
                    <h3 data-project-trigger={project.id}>{project.title}</h3>
                    <h5>{project.roleTitle}</h5>
                    <p>{project.description}</p>
                </div>
            </div>
        ))}
    </div>
</div>

<!-- Modal for project details -->
<div id="project-modal" class="modal-overlay">
    <div class="modal-content">
        <button class="modal-close" id="modal-close">&times;</button>
        <div class="modal-body">
                <h2 id="modal-title"></h2>
                <div class="modal-top-info">
                    <div>
                        <h4 id="modal-role"></h4>
                        <div id="modal-tech" class="modal-tech"></div>
                    </div>
                    <div>
                        <h4>Description</h4>
                        <p id="modal-description"></p>
                    </div>
                    <div>
                        <h4>Links</h4>
                        <div id="modal-links" class="modal-links"></div>
                    </div>
                </div>
                <div id="modal-gallery" class="modal-gallery">
                    <!-- Gallery images will be inserted here -->
                </div>
                <h2>Overview</h2>
                <div id="modal-details" class="modal-details">
                    <!-- Detailed description will be inserted here -->
                </div>
                
            
        </div>
    </div>
</div>

<style>
    .projects-container {
        padding: 20px;
        max-width: 1500px;
        margin: 0 auto;
        text-align: left;
    }

    h2 {
        font-size: 2rem;
        margin-bottom: 20px;
    }

    .project-card {
        transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        overflow: hidden;
        padding: 20px;
        border-radius: 8px;
        width: 100%;
        text-align: left;
        cursor: pointer;
        color: black;
    }

    :global(.dark) .project-card {
        color: white;
    }

    .project-card:hover {
        transform: translateY(-10px);
        box-shadow: 
            0 10px 25px rgba(0, 0, 0, 0.15),
            0 20px 40px rgba(0, 0, 0, 0.08),
            0 0 0 1px rgba(0, 0, 0, 0.05);
    }

    :global(.dark) .project-card:hover {
        box-shadow: 
            0 10px 25px rgba(255, 255, 255, 0.2),
            0 20px 40px rgba(255, 255, 255, 0.1),
            0 0 0 1px rgba(255, 255, 255, 0.1);
    }

    .projects-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        column-gap: 50px;
        row-gap: 30px;
        justify-items: center;
    }

    .project-card h3 {
        font-size: 1.5rem;
        margin-bottom: 10px;
    }

    .project-card p {
        font-size: 1rem;
    }

    .project-image {
        width: 100%;
        height: auto;
        border-radius: 8px;
        margin-bottom: 15px;
    }

    .project-text {
        margin-top: 10px;
    }

    /* Modal Styles */
    .modal-overlay {
        display: flex;
        opacity: 0;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        z-index: 1000;
        pointer-events: none;
        backdrop-filter: blur(5px);
    }

    .modal-overlay.active {
        opacity: 1;
        transition: opacity 0.5s ease;
        justify-content: center;
        align-items: center;
        pointer-events: auto;
    }

    .modal-content {
        background: white;
        border-radius: 12px;
        width: 90%;
        max-width: 1200px;
        max-height: 90%;
        overflow-y: scroll;
        position: relative;
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
    }

    /* Custom scrollbar for modal content */
    .modal-content::-webkit-scrollbar {
        width: 8px;
    }

    .modal-content::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.05);
        border-radius: 6px;
        margin: 12px 4px;
    }

    .modal-content::-webkit-scrollbar-thumb {
        background: rgba(0, 0, 0, 0.2);
        border-radius: 6px;
        border: 1px solid transparent;
        background-clip: content-box;
    }

    .modal-content::-webkit-scrollbar-thumb:hover {
        background: rgba(0, 0, 0, 0.4);
        background-clip: content-box;
    }

    :global(.dark) .modal-content::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 6px;
        margin: 12px 4px;
    }

    :global(.dark) .modal-content::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.2);
        border-radius: 6px;
        border: 1px solid transparent;
        background-clip: content-box;
    }

    :global(.dark) .modal-content::-webkit-scrollbar-thumb:hover {
        background: rgba(255, 255, 255, 0.4);
        background-clip: content-box;
    }

    :global(.dark) .modal-content {
        background: black;
        box-shadow: 0 0 10px 0 rgba(256, 256, 256, 0.5);
        color: white;
    }

    .modal-close {
        position: absolute;
        top: 20px;
        right: 25px;
        background: none;
        border: none;
        font-size: 2rem;
        cursor: pointer;
        color: #666;
        z-index: 1001;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: all 0.3s ease;
    }

    .modal-close:hover {
        background: rgba(0, 0, 0, 0.1);
        color: #333;
    }

    :global(.dark) .modal-close {
        color: #ccc;
    }

    :global(.dark) .modal-close:hover {
        background: rgba(255, 255, 255, 0.1);
        color: white;
    }

    .modal-body {
        height: 100%;
        max-height: 80vh;
        margin-left: 20px;
        margin-right: 20px;
    }


    .modal-left {
        padding: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #f8f9fa;
    }

    :global(.dark) .modal-left {
        background: #2a2a2a;
    }

    .modal-right {
        padding: 40px;
        overflow-y: auto;
    }

    .modal-right h2 {
        margin-top: 0;
        margin-bottom: 10px;
        font-size: 2rem;
    }

    .modal-right h4 {
        color: #666;
        margin-bottom: 20px;
        font-weight: normal;
    }

    :global(.dark) .modal-right h4 {
        color: #ccc;
    }

    .modal-tech {
        margin-bottom: 20px;
    }

    .modal-tech h5 {
        margin-bottom: 5px;
        color: #333;
    }

    .modal-top-info {
        display: flex;
        justify-content: space-between;
        align-items: left;
    }

    .modal-top-info > * {
        width: 50%;
        padding-right: 35px;
    }

    @media (max-width: 768px) {
        :global(.modal-top-info) {
            flex-direction: column;
        }

        :global(.modal-top-info > *) {
            width: 100% !important;
            padding-right: 0 !important;
        }

        :global(.image-gallery img),
        :global(.image-gallery video) {
            max-width: 80vw !important;
            width: 100% !important;
        }
    }

    :global(.dark) .modal-tech h5 {
        color: #ddd;
    }

    .modal-links {
        margin-bottom: 20px;
    }

    .modal-links h5 {
        margin-bottom: 10px;
        color: #333;
    }

    :global(.dark) .modal-links h5 {
        color: #ddd;
    }

    .modal-links ul {
        margin: 0;
        padding-left: 20px;
    }

    :global(.modal-links a) {
        color: black !important;
        transition: color 0.3s;
    }

    :global(.modal-links a:hover) {
        color: #0056b3 !important;
    }

    :global(.dark) :global(.modal-links a) {
        color: white !important;
    }

    :global(.dark) :global(.modal-links a:hover) {
        color: #99ccff !important;
    }

    :global(.modal-details) {
        margin-top: 20px;
        font-size: 1.1rem;
        line-height: 1.6;
        padding-bottom: 20px;
    }

    /* Modal Gallery styles */
    .modal-gallery {
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }

    :global(.modal-gallery .image-gallery) {
        padding-top: 20px;
        position: relative;
        width: 100%;
        display: flex;
        flex-direction: column;
        width: 100%;
        align-items: center;
    }

    .modal-gallery .gallery-media,
    #modal-gallery .gallery-media {
        width: 80%;
        height: auto;
        border-radius: 8px;
        max-height: 60vh;
        object-fit: contain;
        margin: 0 auto;
        display: block;
    }

    /* Specific styles for videos */
    .modal-gallery .gallery-video,
    #modal-gallery .gallery-video {
        background: black;
    }

    /* If media height exceeds 50vh, reduce width to maintain better proportions */
    @media (max-height: 800px) {
        .modal-gallery .gallery-media,
        #modal-gallery .gallery-media {
            width: 70%;
        }
    }

    @media (max-height: 600px) {
        .modal-gallery .gallery-media,
        #modal-gallery .gallery-media {
            width: 60%;
        }
    }

    /* For very tall media (portrait orientation), reduce width */
    .modal-gallery .gallery-media.tall-image,
    #modal-gallery .gallery-media.tall-image {
        width: 60%;
    }

    /* For extremely tall media, reduce width even more */
    .modal-gallery .gallery-media.very-tall-image,
    #modal-gallery .gallery-media.very-tall-image {
        width: 50%;
    }

    :global(.modal-gallery .gallery-controls),
    :global(#modal-gallery .gallery-controls) {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 20px;
        margin-top: 15px;
    }

    :global(.modal-gallery .gallery-prev),
    :global(.modal-gallery .gallery-next),
    :global(#modal-gallery .gallery-prev),
    :global(#modal-gallery .gallery-next) {
        background: rgba(0, 0, 0, 0.6);
        color: white;
        border: none;
        border-radius: 50%;
        width: 45px;
        height: 45px;
        cursor: pointer;
        font-size: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
    }

    #modal-description {
        padding-right: 35px;
    }

    :global(.modal-gallery .gallery-prev:hover), 
    :global(.modal-gallery .gallery-next:hover),
    :global(#modal-gallery .gallery-prev:hover),
    :global(#modal-gallery .gallery-next:hover) {
        background: rgba(0, 0, 0, 0.8);
        transform: scale(1.1);
    }

    :global(.modal-gallery .gallery-counter),
    :global(#modal-gallery .gallery-counter) {
        color: #333;
        font-size: 16px;
        font-weight: 500;
    }

    :global(.dark) :global(.modal-gallery .gallery-counter),
    :global(.dark) :global(#modal-gallery .gallery-counter) {
        color: #ddd;
    }

    @media (max-width: 768px) {
        .projects-container {
            padding: 0;
        }

        .projects-grid {
            display: block;
        }

        .modal-content {
            width: 95%;
            max-height: 95%;
        }

        .modal-left {
            padding: 20px;
        }

        .modal-right {
            padding: 20px;
            max-height: 40vh;
        }

        .modal-gallery .gallery-media,
        #modal-gallery .gallery-media {
            max-height: 40vh;
            width: 90%;
        }

        /* For mobile, if the viewport is very short, reduce width further */
        @media (max-height: 500px) {
            .modal-gallery .gallery-media,
            #modal-gallery .gallery-media {
                width: 70%;
            }
        }

        .modal-close {
            top: 15px;
            right: 15px;
            font-size: 1.5rem;
            width: 35px;
            height: 35px;
        }
    }
</style>

<script define:vars={{ projects }}>
    console.log(projects);
    let currentGalleryIndex = {};
    
    const checkImageAspectRatio = (img) => {
        // Wait for image to load completely
        if (img.complete && img.naturalHeight !== 0) {
            const aspectRatio = img.naturalWidth / img.naturalHeight;
            
            // If aspect ratio is less than 1, it's a portrait image
            // If aspect ratio is less than 0.7, it's a very tall portrait image
            if (aspectRatio < 0.7) {
                img.classList.add('very-tall-image');
            } else if (aspectRatio < 1) {
                img.classList.add('tall-image');
            }
            
            // Also check if the image height would be too large relative to viewport
            const viewportHeight = window.innerHeight;
            const maxAllowedHeight = viewportHeight * 0.6; // 60vh
            
            if (img.naturalHeight > maxAllowedHeight && aspectRatio < 1.2) {
                if (!img.classList.contains('very-tall-image')) {
                    img.classList.add('tall-image');
                }
            }
        }
    }

    const checkVideoAspectRatio = (video) => {
        // Wait for video metadata to load completely
        if (video.readyState >= 1) { // HAVE_METADATA
            const aspectRatio = video.videoWidth / video.videoHeight;
            
            // If aspect ratio is less than 1, it's a portrait video
            // If aspect ratio is less than 0.7, it's a very tall portrait video
            if (aspectRatio < 0.7) {
                video.classList.add('very-tall-image');
            } else if (aspectRatio < 1) {
                video.classList.add('tall-image');
            }
            
            // Also check if the video height would be too large relative to viewport
            const viewportHeight = window.innerHeight;
            const maxAllowedHeight = viewportHeight * 0.6; // 60vh
            
            if (video.videoHeight > maxAllowedHeight && aspectRatio < 1.2) {
                if (!video.classList.contains('very-tall-image')) {
                    video.classList.add('tall-image');
                }
            }
        }
    }

    window.checkImageAspectRatio = checkImageAspectRatio;
    window.checkVideoAspectRatio = checkVideoAspectRatio;
    
    function openModal(projectId) {
        const project = projects.find(p => p.id === projectId);
        if (!project) return;
        
        const modal = document.getElementById('project-modal');
        if (!modal) return;
        
        // Populate modal content
        const modalTitle = document.getElementById('modal-title');
        const modalRole = document.getElementById('modal-role');
        const modalDescription = document.getElementById('modal-description');
        
        if (modalTitle) modalTitle.textContent = project.title;
        if (modalRole) modalRole.textContent = project.roleTitle || '';
        if (modalDescription) modalDescription.textContent = project.description;
        
        // Tech stack
        const modalTech = document.getElementById('modal-tech');
        if (modalTech) {
            if (project.techUsed) {
                modalTech.innerHTML = `<h5>Tools: ${project.techUsed}</h5>`;
                modalTech.style.display = 'block';
            } else {
                modalTech.style.display = 'none';
            }
        }
        
        // Links
        const modalLinks = document.getElementById('modal-links');
        if (modalLinks) {
            if (project.links && project.links.length > 0) {
                const linksHtml = `
                    <ul>
                        ${project.links.map(link => 
                            `<li><a href="${link.link}" target="_blank" rel="noopener noreferrer">${link.text}</a></li>`
                        ).join('')}
                    </ul>
                `;
                modalLinks.innerHTML = linksHtml;
                modalLinks.style.display = 'block';
            } else {
                modalLinks.style.display = 'none';
            }
        }
        
        // Details
        const modalDetails = document.getElementById('modal-details');
        if (modalDetails) {
            if (project.details) {
                modalDetails.innerHTML = `<p>${project.details}</p>`;
                modalDetails.style.display = 'block';
            } else {
                modalDetails.style.display = 'none';
            }
        }
        
        // Gallery
        const modalGallery = document.getElementById('modal-gallery');
        if (modalGallery) {
            if (project.gallery && project.gallery.length > 0) {
                currentGalleryIndex[projectId] = 0;
                const galleryHtml = `
                    <div class="image-gallery">
                        ${project.gallery.map((media, index) => {
                            const mediaType = media.type || 'image';
                            const displayStyle = index === 0 ? 'display: block; border-radius: 8px; max-width: 80%;' : 'display: none; border-radius: 8px; max-width: 80%;';
                            
                            if (mediaType === 'video') {
                                return `<video 
                                    src="${media.original}" 
                                    class="gallery-media gallery-video"
                                    style="${displayStyle}"
                                    data-gallery="${projectId}"
                                    data-index="${index}"
                                    controls
                                    muted
                                    preload="metadata"
                                    onloadedmetadata="checkVideoAspectRatio(this)"
                                >
                                    Your browser does not support the video tag.
                                </video>`;
                            } else {
                                return `<img 
                                    src="${media.original}" 
                                    alt="${project.title} gallery ${index + 1}"
                                    class="gallery-media gallery-image"
                                    style="${displayStyle}"
                                    data-gallery="${projectId}"
                                    data-index="${index}"
                                    onload="checkImageAspectRatio(this)"
                                />`;
                            }
                        }).join('')}
                        ${project.gallery.length > 1 ? `
                            <div class="gallery-controls">
                                <button class="gallery-prev" data-gallery="${projectId}">‹</button>
                                <span class="gallery-counter">
                                    <span class="gallery-current">1</span> / ${project.gallery.length}
                                </span>
                                <button class="gallery-next" data-gallery="${projectId}">›</button>
                            </div>
                        ` : ''}
                    </div>
                `;
                modalGallery.innerHTML = galleryHtml;
                
                // Debug: Log the created elements
                console.log('Gallery HTML created:', galleryHtml);
                console.log('Gallery controls found:', modalGallery.querySelector('.gallery-controls'));
                console.log('Gallery buttons found:', modalGallery.querySelectorAll('.gallery-prev, .gallery-next'));
                
                // Add gallery event listeners
                if (project.gallery.length > 1) {
                    const prevBtn = modalGallery.querySelector('.gallery-prev');
                    const nextBtn = modalGallery.querySelector('.gallery-next');
                    
                    if (prevBtn) {
                        prevBtn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            navigateGallery(projectId, -1);
                        });
                    }
                    
                    if (nextBtn) {
                        nextBtn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            navigateGallery(projectId, 1);
                        });
                    }
                }
            } else {
                // Show main project image if no gallery
                modalGallery.innerHTML = `
                    <div class="image-gallery">
                        <img src="${project.imageUrl}" alt="${project.title}" class="gallery-media gallery-image" style="display: block;" onload="checkImageAspectRatio(this)" />
                    </div>
                `;
            }
        }
        
        // Show modal
        modal.classList.add('active');
        document.body.style.overflow = 'hidden'; // Prevent background scroll
    }
    
    function closeModal() {
        const modal = document.getElementById('project-modal');
        if (modal) {
            modal.classList.remove('active');
            document.body.style.overflow = ''; // Restore background scroll
        }
    }
    
    function navigateGallery(galleryId, direction) {
        const project = projects.find(p => p.id === galleryId);
        if (!project || !project.gallery) return;
        
        const totalImages = project.gallery.length;
        let newIndex = currentGalleryIndex[galleryId] + direction;
        
        if (newIndex < 0) newIndex = totalImages - 1;
        if (newIndex >= totalImages) newIndex = 0;
        
        currentGalleryIndex[galleryId] = newIndex;
        
        // Hide all media items (images and videos)
        const mediaItems = document.querySelectorAll(`[data-gallery="${galleryId}"]`);
        mediaItems.forEach(media => {
            if (media.classList.contains('gallery-media')) {
                media.style.display = 'none';
                // Pause videos when hiding them
                if (media.tagName === 'VIDEO') {
                    media.pause();
                }
            }
        });
        
        // Show the new media item
        const newMedia = document.querySelector(`[data-gallery="${galleryId}"][data-index="${newIndex}"]`);
        if (newMedia) {
            newMedia.style.display = 'block';
        }
        
        // Update counter
        const counter = document.querySelector('.gallery-current');
        if (counter) {
            counter.textContent = (newIndex + 1).toString();
        }
    }
    
    // Initialize when DOM is ready
    document.addEventListener('DOMContentLoaded', () => {
        // Add click event listeners to project triggers
        document.querySelectorAll('[data-project-trigger]').forEach(trigger => {
            trigger.addEventListener('click', () => {
                const projectIdStr = trigger.getAttribute('data-project-trigger');
                if (projectIdStr) {
                    const projectId = parseInt(projectIdStr);
                    openModal(projectId);
                }
            });
        });
        
        // Close modal events
        const modalClose = document.getElementById('modal-close');
        const modalOverlay = document.getElementById('project-modal');
        
        if (modalClose) {
            modalClose.addEventListener('click', closeModal);
        }
        
        if (modalOverlay) {
            modalOverlay.addEventListener('click', (e) => {
                if (e.target === modalOverlay) {
                    closeModal();
                }
            });
        }
        
        // Escape key to close modal
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeModal();
            }
        });
    });
</script>
